{# ─────────────────────────────────────────────────────────────
  File: src/templates/teacher.html
  SKELETON — all routes / variables must be supplied by Flask
  ------------------------------------------------------------
  JINJA VARIABLES EXPECTED
    settings.max_choices    int   # e.g. 5
    settings.group_size     int   # e.g. 4
    satisfaction_pct        float # e.g. 81.2  (computed in algo.py)
    students                list  # [{id, firstname, lastname}]
    groups                  list  # [[id1,id2,…], …]  | optional
---------------------------------------------------------------- #}

{% extends "base.html" %}
{% block title %}Teacher dashboard{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-8">Teacher dashboard</h1>

{# ── PARAMETERS ────────────────────────────────────────────── #}
<section class="mb-10">
  <h2 class="text-xl font-semibold mb-4">Parameters</h2>

  <form method="post" action="{{ url_for('teacher.update_settings') }}"
        class="flex flex-wrap gap-8 items-end">
    <div>
      <label class="block font-medium mb-1" for="max_choices">Max wishes / student</label>
      <input type="number" min="1" max="10" id="max_choices" name="max_choices"
             value="{{ settings.max_choices }}"
             class="w-24 border rounded px-2 py-1">
    </div>

    <div>
      <label class="block font-medium mb-1" for="group_size">Students per group</label>
      <input type="number" min="2" max="10" id="group_size" name="group_size"
             value="{{ settings.group_size }}"
             class="w-24 border rounded px-2 py-1">
    </div>

    <button type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
      Save settings
    </button>
  </form>
</section>

{# ── STUDENT LIST ──────────────────────────────────────────── #}
<section class="mb-10">
  <h2 class="text-xl font-semibold mb-4">Students ({{ students|length }})</h2>

  <table class="w-full border rounded">
    <thead>
      <tr class="bg-gray-100 text-left">
        <th class="px-3 py-2">#</th>
        <th class="px-3 py-2">First name</th>
        <th class="px-3 py-2">Last name</th>
        <th class="px-3 py-2">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for st in students %}
      <tr class="border-t">
        <td class="px-3 py-1">{{ loop.index }}</td>
        <td class="px-3 py-1">{{ st.firstname }}</td>
        <td class="px-3 py-1">{{ st.lastname }}</td>
        <td class="px-3 py-1">
          <form method="post"
                action="{{ url_for('teacher.remove_student', id=st.id) }}">
            <button class="text-red-600 hover:underline">remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

{# ── SATISFACTION & ACTIONS ───────────────────────────────── #}
<section class="mb-10">
  <h2 class="text-xl font-semibold mb-4">Global satisfaction</h2>
  <p class="text-3xl font-bold mb-6">{{ satisfaction_pct | default(0) }} %</p>

  <div class="flex flex-wrap gap-4">
    <form method="post" action="{{ url_for('teacher.run_clustering') }}">
      <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Create groups
      </button>
    </form>

    <form method="post" action="{{ url_for('teacher.publish_groups') }}">
      <button class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
        Publish to students
      </button>
    </form>
  </div>
</section>

{# ── GROUPS PREVIEW (optional) ─────────────────────────────── #}
{% if groups %}
<section>
  <h2 class="text-xl font-semibold mb-4">Generated groups</h2>

  <div class="grid md:grid-cols-2 gap-6">
    {% for g in groups %}
    <div class="border rounded p-4">
      <h3 class="font-semibold mb-2">Group {{ loop.index }}</h3>
      <ul class="list-disc list-inside">
        {% for sid in g %}
          {% set st = students|selectattr('id', 'equalto', sid)|first %}
          <li>{{ st.firstname }} {{ st.lastname }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock %}
